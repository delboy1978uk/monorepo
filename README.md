# fake monorepo
for testing  monorepo release cycle
## requirements
- Git
- PHP with Composer
- [Tomono](https://github.com/hraban/tomono/tree/master)
## setup
Create a `repos.txt` file containing the links to the repos you want in the monorepo, an alias, and it's path:
```
git@github.com:delboy1978uk/fakeproject1.git fakeproject1 projects/fakeproject1
git@github.com:delboy1978uk/fakeproject2.git fakeproject2 projects/fakeproject2
```
Run the following command to initialise the monorepo.
```
MONOREPO_NAME=whatever ./path/to/tomono < repos.txt
```
This will create a folder using the `MONOREPO_NAME`, and clone each repository into the projects folder. You will notice
that the Git history has been preserved if you check with `git log`. 

Use composer to install Monorepo Builder
```
composer require --dev symplify/monorepo-builder  
```
Then initialise it:
```
vendor/bin/monorepo-builder init
```
Finally, go to your original repos and update their descriptions saying that they are a [READ ONLY] subtree split of the 
monorepo. 
## usage
The first thing we need o do is merge the monorepo composer json. This will take all dependencies from your projects and
put them in a `composer.json` in the root folder:
```
vendor/bin/monorepo-builder merge
```
Do not edit this file! Only ever the json files in the projects themselves. 
We can run the following to validate all projects have compatible dependencies:
```
vendor/bin/monorepo-builder validate
```
Please see the [monoreaper-builder](https://github.com/symplify/monorepo-builder?tab=readme-ov-file#not-only-composer-tools-to-build-a-monorepo) 
README for more info.

## Github Action
The Github Action workflow validates the root Composer json, and tests each project on each version of PHP specified.

If tests succeed, it then splits the monorepo and pushes the code to the respective repository.

## tagging releases
Tags are applied across all projects. To tag releases:
```
vendor/bin/monorepo-builder release 7.0
```
